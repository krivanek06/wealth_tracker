<div class="flex items-center justify-between p-2 mb-4 sm:hidden">
	<div class="g-section-title">Holdings</div>

	<!-- button on small screen -->
	<button mat-button class="text-wt-primary-dark" (click)="toggleDailyChange()">
		{{ showDailyChange ? 'Daily +/-' : 'Invested +/-'}}
	</button>
</div>

<table
	mat-table
	[dataSource]="dataSource"
	matSort
	class="w-full"
	[trackBy]="identity"
	(matSortChange)="sortData($event)"
>
	<!-- image & name -->
	<ng-container matColumnDef="symbol">
		<th mat-header-cell mat-sort-header *matHeaderCellDef class="hidden sm:table-cell">Symbol</th>
		<td mat-cell *matCellDef="let row">
			<!-- logo + symbol -->
			<div class="flex items-center gap-2">
				<img [src]="row.assetGeneral.assetQuote.symbolImageURL" appDefaultImg class="w-10 h-10" />
				<div class="flex flex-col">
					<!-- asset symbol + sector -->
					<div class="flex flex-row text-base sm:text-sm sm:flex-col gap-x-2">
						<span class="flex items-center gap-1 text-wt-gray-light">
							<span>{{ row.assetId }}</span>
							<span class="hidden sm:table-cell">({{ row.units }})</span>
						</span>
						<span class="hidden text-wt-gray-dark xs:max-sm:table-cell">|</span>
						<span class="hidden text-wt-gray-medium xs:table-cell">{{ row.sector }}</span>
					</div>

					<!-- Price * units | BEP  -->
					<div class="table-cell text-sm text-wt-gray-medium sm:hidden">
						{{ row.assetGeneral.assetQuote.price | currency }} * {{ row.units }} | {{ (row.beakEvenPrice) | currency }}
					</div>
				</div>
			</div>
		</td>
	</ng-container>

	<!-- price -->
	<ng-container matColumnDef="price">
		<th mat-header-cell mat-sort-header *matHeaderCellDef class="hidden sm:table-cell">Price +/- | BEP.</th>
		<td mat-cell *matCellDef="let row" class="hidden sm:table-cell">
			<div class="text-base text-wt-gray-light">
				<span>{{ row.assetGeneral.assetQuote.price | currency }}</span>
				<span class="text-wt-gray-medium"> | ({{ (row.beakEvenPrice ) | currency }})</span>
			</div>
			<div
				appPerceptageIncrease
				[useCurrencySign]="true"
				[changeValues]="{
          change: row.assetGeneral.assetQuote.change,
          changesPercentage: row.assetGeneral.assetQuote.changesPercentage
        }"
			></div>
		</td>
	</ng-container>

	<!-- Invested -->
	<ng-container matColumnDef="invested">
		<th mat-header-cell mat-sort-header *matHeaderCellDef class="hidden sm:table-cell">Invested +/- | Portfolio %</th>
		<td mat-cell *matCellDef="let row" class="hidden sm:table-cell">
			<div class="text-base text-wt-gray-light">
				<span>{{ row.totalValue | currency }}</span>
				<span class="text-wt-gray-medium">
					<ng-container *ngIf="totalInvestedAmount">
						| ({{ row.totalValue / totalInvestedAmount | percent: '1.2-2'}})
					</ng-container>
					<ng-container *ngIf="!totalInvestedAmount">N/A</ng-container>
				</span>
			</div>
			<div
				appPerceptageIncrease
				[useCurrencySign]="true"
				[currentValues]="{
            value: row.assetGeneral.assetQuote.price  * row.units,
            valueToCompare: row.beakEvenPrice  * row.units
        }"
			></div>
		</td>
	</ng-container>

	<!-- Invested on small scree -->
	<ng-container matColumnDef="invested_xs">
		<th mat-header-cell *matHeaderCellDef class="table-cell sm:hidden"></th>
		<td mat-cell *matCellDef="let row" class="table-cell sm:hidden">
			<!-- show invested amount -->
			<ng-container *ngIf="!showDailyChange">
				<div class="text-base text-end text-wt-gray-light">{{ row.totalValue | currency }}</div>
				<div
					class="justify-end text-sm"
					appPerceptageIncrease
					[useCurrencySign]="true"
					[currentValues]="{
            value: row.assetGeneral.assetQuote.price  * row.units,
            valueToCompare: row.beakEvenPrice  * row.units,
            hideValue: true
        }"
				></div>
			</ng-container>

			<!-- show daily change -->
			<ng-container *ngIf="showDailyChange">
				<div class="text-base text-end text-wt-gray-light">{{ row.assetGeneral.assetQuote.price | currency }}</div>
				<div
					class="justify-end text-sm"
					appPerceptageIncrease
					[useCurrencySign]="true"
					[changeValues]="{
            changesPercentage: row.assetGeneral.assetQuote.changesPercentage
          }"
				></div>
			</ng-container>
		</td>
	</ng-container>

	<!-- volume -->
	<ng-container matColumnDef="volume">
		<th mat-header-cell *matHeaderCellDef class="hidden md:table-cell">Volume +/-</th>
		<td mat-cell *matCellDef="let row" class="hidden md:table-cell">
			<div class="text-base">{{ row.assetGeneral.assetQuote.avgVolume | largeNumberFormatter }}</div>
			<div
				appPerceptageIncrease
				[currentValues]="{
          value: row.assetGeneral.assetQuote.avgVolume,
          valueToCompare: row.assetGeneral.assetQuote.volume
      }"
			></div>
		</td>
	</ng-container>

	<!-- 52 week change -->
	<ng-container matColumnDef="52WeekRange">
		<th mat-header-cell *matHeaderCellDef class="hidden lg:table-cell">52 Week range</th>
		<td mat-cell *matCellDef="let row" class="hidden lg:table-cell">
			<div style="width: 90%">
				<app-progress-currency
					[max]="row.assetGeneral.assetQuote.yearHigh"
					[min]="row.assetGeneral.assetQuote.yearLow"
					[value]="row.assetGeneral.assetQuote.price"
				>
				</app-progress-currency>
			</div>
		</td>
	</ng-container>

	<ng-container matColumnDef="addditional_info">
		<th mat-header-cell *matHeaderCellDef class="hidden xl:table-cell">Additional info</th>
		<td mat-cell *matCellDef="let row" class="hidden text-sm xl:table-cell">
			<div class="flex items-center gap-2">
				<!-- PE -->
				<div>
					<span class="text-wt-gray-dark">PE:</span>
					<span>
						{{row.assetGeneral.assetQuote.pe ? ( row.assetGeneral.assetQuote.pe | number: '1.2-2' ) : 'N/A' }}</span
					>
				</div>
				<div>|</div>
				<!-- EPS -->
				<div>
					<span class="text-wt-gray-dark">EPS:</span>
					<span>
						{{ row.assetGeneral.assetQuote.eps ? ( row.assetGeneral.assetQuote.eps | number: '1.2-2') : 'N/A' }}</span
					>
				</div>
			</div>

			<!-- Shares outstanding -->
			<div class="flex items-center gap-2">
				<span class="text-wt-gray-dark">Shares:</span>
				<span> {{ row.assetGeneral.assetQuote.sharesOutstanding | largeNumberFormatter }}</span>
			</div>
		</td>
	</ng-container>

	<tr mat-header-row *matHeaderRowDef="displayedColumns" class="hidden sm:contents"></tr>
	<tr mat-row *matRowDef="let row; columns: displayedColumns" (click)="onItemClicked(row)"></tr>

	<!-- Row shown when there is no matching data. -->
	<tr class="mat-row" *matNoDataRow>
		<td class="mat-cell" colspan="10">No data has been found</td>
	</tr>
</table>

<!-- pagination -->
<div *ngIf="dataSource.filteredData" class="flex items-center justify-end">
	<mat-paginator
		appStylePaginator
		showFirstLastButtons
		[length]="dataSource.filteredData.length"
		[appCustomLength]="dataSource.filteredData.length"
		[pageSize]="12"
	></mat-paginator>
</div>
