<div class="flex justify-between items-center p-2 mb-4">
	<div class="g-section-title">Holdings</div>

	<!-- buttons big screen -->
	<div class="hidden sm:flex items-center gap-4">
		<ng-container *ngTemplateOutlet="buttonContainer"></ng-container>
	</div>

	<!-- button on small screen -->
	<button mat-button class="g-color-primary sm:hidden" (click)="toggleDailyChange()">
		{{ showDailyChange ? 'Daily +/-' : 'Invested +/-'}}
	</button>
</div>

<!-- buttons small screen -->
<div class="block sm:hidden">
	<ng-container *ngTemplateOutlet="buttonContainer"></ng-container>
</div>

<ng-template #buttonContainer>
	<!-- add holding -->
	<button
		(click)="onAddClick()"
		mat-stroked-button
		type="button"
		color="primary"
		class="w-full mb-2 sm:w-auto sm:block"
	>
		<mat-icon>add</mat-icon>
		Add holding
	</button>

	<!-- show transactions -->
	<button
		(click)="onShowHistoryClick()"
		mat-stroked-button
		type="button"
		class="w-full mb-2 sm:w-auto sm:block g-color-secondary"
	>
		<mat-icon>visibility</mat-icon>
		Show transactions
	</button>
</ng-template>

<table mat-table [dataSource]="dataSource" matSort class="w-full" [trackBy]="identity">
	<!-- image & name -->
	<ng-container matColumnDef="symbol">
		<th mat-header-cell *matHeaderCellDef class="hidden sm:table-cell">Symbol</th>
		<td mat-cell *matCellDef="let row">
			<!-- logo + symbol -->
			<div class="flex items-center gap-2">
				<img [src]="row.assetGeneral.assetQuote.symbolImageURL" imageType="url" appDefaultImg class="h-8 w-8" />
				<div class="flex flex-col">
					<!-- asset symbol + sector -->
					<div class="flex flex-row sm:flex-col gap-x-2">
						<span class="g-color-text-normal flex gap-1 items-center">
							<span>{{ row.assetId }}</span>
							<span class="hidden sm:table-cell">({{ row.units }})</span>
						</span>
						<span class="text-gray-500 hidden xs:max-sm:table-cell">|</span>
						<span class="text-gray-400 hidden xs:table-cell">{{ row.sector }}</span>
					</div>

					<!-- Price * units | BEP  -->
					<div class="text-xs text-gray-500 table-cell sm:hidden">
						{{ row.assetGeneral.assetQuote.price | currency }} * {{ row.units }} | {{ (row.beakEvenPrice) | currency }}
					</div>
				</div>
			</div>
		</td>
	</ng-container>

	<!-- price -->
	<ng-container matColumnDef="price">
		<th mat-header-cell *matHeaderCellDef class="hidden sm:table-cell">Price +/-</th>
		<td mat-cell *matCellDef="let row" class="hidden sm:table-cell">
			<div class="text-base">{{ row.assetGeneral.assetQuote.price | currency }}</div>
			<div
				appPerceptageIncrease
				[useCurrencySign]="true"
				[changeValues]="{
          change: row.assetGeneral.assetQuote.change,
          changesPercentage: row.assetGeneral.assetQuote.changesPercentage
        }"
			></div>
		</td>
	</ng-container>

	<!-- Invested -->
	<ng-container matColumnDef="invested">
		<th mat-header-cell *matHeaderCellDef class="hidden sm:table-cell">Invested +/-</th>
		<td mat-cell *matCellDef="let row" class="hidden sm:table-cell">
			<div class="text-base">{{ row.totalValue | currency }}</div>
			<div
				appPerceptageIncrease
				[useCurrencySign]="true"
				[currentValues]="{
            value: row.assetGeneral.assetQuote.price  * row.units,
            valueToCompare: row.beakEvenPrice  * row.units
        }"
			></div>
		</td>
	</ng-container>

	<!-- Invested on small scree -->
	<ng-container matColumnDef="invested_xs">
		<th mat-header-cell *matHeaderCellDef class="table-cell sm:hidden"></th>
		<td mat-cell *matCellDef="let row" class="table-cell sm:hidden">
			<!-- show invested amount -->
			<ng-container *ngIf="!showDailyChange">
				<div class="text-end">{{ row.totalValue | currency }}</div>
				<div
					class="justify-end"
					appPerceptageIncrease
					[useCurrencySign]="true"
					[currentValues]="{
            value: row.assetGeneral.assetQuote.price  * row.units,
            valueToCompare: row.beakEvenPrice  * row.units,
            hideValue: true
        }"
				></div>
			</ng-container>

			<!-- show daily change -->
			<ng-container *ngIf="showDailyChange">
				<div class="text-end">{{ row.assetGeneral.assetQuote.price | currency }}</div>
				<div
					class="justify-end"
					appPerceptageIncrease
					[useCurrencySign]="true"
					[changeValues]="{
            changesPercentage: row.assetGeneral.assetQuote.changesPercentage
          }"
				></div>
			</ng-container>
		</td>
	</ng-container>

	<!-- volume -->
	<ng-container matColumnDef="volume">
		<th mat-header-cell *matHeaderCellDef class="hidden md:table-cell">Volume +/-</th>
		<td mat-cell *matCellDef="let row" class="hidden md:table-cell">
			<div class="text-base">{{ row.assetGeneral.assetQuote.avgVolume | largeNumberFormatter }}</div>
			<div
				appPerceptageIncrease
				[currentValues]="{
          value: row.assetGeneral.assetQuote.avgVolume,
          valueToCompare: row.assetGeneral.assetQuote.volume
      }"
			></div>
		</td>
	</ng-container>

	<!-- Statistics -->
	<ng-container matColumnDef="statistics">
		<th mat-header-cell *matHeaderCellDef class="hidden md:table-cell">Statistics</th>
		<td mat-cell *matCellDef="let row" class="hidden md:table-cell text-sm">
			<!-- BEP -->
			<div class="flex items-center gap-2">
				<span class="text-gray-500">BEP:</span>
				<span> {{ (row.beakEvenPrice ) | currency }}</span>
			</div>

			<!-- Profolio % -->
			<div class="flex items-center gap-2">
				<span class="text-gray-500">Portfolio:</span>
				<span>
					<ng-container *ngIf="totalInvestedAmount">
						{{ row.totalValue / totalInvestedAmount | percent: '1.2-2'}}
					</ng-container>
					<ng-container *ngIf="!totalInvestedAmount">N/A</ng-container>
				</span>
			</div>
		</td>
	</ng-container>

	<!-- 52 week change -->
	<ng-container matColumnDef="52WeekRange">
		<th mat-header-cell *matHeaderCellDef class="hidden lg:table-cell">52 Week range</th>
		<td mat-cell *matCellDef="let row" class="hidden lg:table-cell">
			<div style="width: 90%">
				<app-progress-item
					[max]="row.assetGeneral.assetQuote.yearHigh"
					[min]="row.assetGeneral.assetQuote.yearLow"
					[value]="row.assetGeneral.assetQuote.price"
				>
				</app-progress-item>
			</div>
		</td>
	</ng-container>

	<ng-container matColumnDef="addditional_info">
		<th mat-header-cell *matHeaderCellDef class="hidden xl:table-cell">Additional info</th>
		<td mat-cell *matCellDef="let row" class="hidden xl:table-cell text-sm">
			<div class="flex items-center gap-2">
				<!-- PE -->
				<div>
					<span class="text-gray-500">PE:</span>
					<span>
						{{row.assetGeneral.assetQuote.pe ? ( row.assetGeneral.assetQuote.pe | number: '1.2-2' ) : 'N/A' }}</span
					>
				</div>
				<div>|</div>
				<!-- EPS -->
				<div>
					<span class="text-gray-500">EPS:</span>
					<span>
						{{ row.assetGeneral.assetQuote.eps ? ( row.assetGeneral.assetQuote.eps | number: '1.2-2') : 'N/A' }}</span
					>
				</div>
			</div>

			<!-- Shares outstanding -->
			<div class="flex items-center gap-2">
				<span class="text-gray-500">Shares:</span>
				<span> {{ row.assetGeneral.assetQuote.sharesOutstanding | largeNumberFormatter }}</span>
			</div>
		</td>
	</ng-container>

	<tr mat-header-row *matHeaderRowDef="displayedColumns" class="hidden sm:contents"></tr>
	<tr mat-row *matRowDef="let row; columns: displayedColumns" (click)="onItemClicked(row)"></tr>

	<!-- Row shown when there is no matching data. -->
	<tr class="mat-row" *matNoDataRow>
		<td class="mat-cell text-center" colspan="10">No holdings to be found</td>
	</tr>
</table>
