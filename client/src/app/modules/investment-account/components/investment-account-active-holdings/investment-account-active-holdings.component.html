<div class="flex justify-end sm:hidden p-2">
	<button mat-stroked-button class="g-color-primary" (click)="toggleDailyChange()">
		{{ showDailyChange ? 'Daily +/-' : 'Unrealized +/-'}}
	</button>
</div>

<table mat-table [dataSource]="dataSource" matSort class="w-full" [trackBy]="identity">
	<!-- image & name -->
	<ng-container matColumnDef="symbol">
		<th mat-header-cell *matHeaderCellDef class="hidden sm:table-cell">Symbol</th>
		<td mat-cell *matCellDef="let row">
			<!-- logo + symbol -->
			<div class="flex items-center gap-2">
				<img [src]="row.assetGeneral.assetQuote.symbolImageURL" imageType="url" appDefaultImg class="h-8" />
				<div class="flex flex-col">
					<span>{{ row.assetId }}</span>
					<span>{{ row.sector }}</span>
					<!-- TODO: small screen show investe + units -->
					<!-- <span class="text-base text-gray-500 table-cell sm:hidden">
						<span class="text-gray-500 text-base">{{ row.summary.marketPrice | currency }}</span>
						* {{ row.units }} | {{ row.breakEvenPrice | currency }}
					</span> -->
				</div>
			</div>
		</td>
	</ng-container>

	<!-- invested -->
	<ng-container matColumnDef="invested">
		<th mat-header-cell *matHeaderCellDef class="hidden sm:table-cell">Invested</th>
		<td mat-cell *matCellDef="let row" class="hidden sm:table-cell">
			{{ row.holdingHistory[row.holdingHistory.length -1].investedAmount | currency }}
		</td>
	</ng-container>

	<!-- units -->
	<ng-container matColumnDef="units">
		<th mat-header-cell *matHeaderCellDef class="hidden sm:table-cell">Units</th>
		<td mat-cell *matCellDef="let row" class="hidden sm:table-cell">
			{{ row.holdingHistory[row.holdingHistory.length -1].units }}
		</td>
	</ng-container>

	<!-- BEP -->
	<ng-container matColumnDef="bep">
		<th mat-header-cell *matHeaderCellDef class="hidden sm:table-cell">BEP.</th>
		<td mat-cell *matCellDef="let row" class="hidden sm:table-cell">
			{{ (row.holdingHistory[row.holdingHistory.length -1].investedAmount / row.holdingHistory[row.holdingHistory.length
			-1].units ) | currency }}
		</td>
	</ng-container>

	<!-- price -->
	<ng-container matColumnDef="price">
		<th mat-header-cell *matHeaderCellDef class="hidden sm:table-cell">Price +/-</th>
		<td mat-cell *matCellDef="let row" class="hidden sm:table-cell">
			<span> {{ row.assetGeneral.assetQuote.price | currency }} </span>
		</td>
	</ng-container>

	<!-- total change -->
	<ng-container matColumnDef="total">
		<th mat-header-cell *matHeaderCellDef class="hidden sm:table-cell">Total +/-</th>
		<td mat-cell *matCellDef="let row" class="hidden sm:table-cell">
			{{( (row.holdingHistory[row.holdingHistory.length -1].investedAmount *
			row.holdingHistory[row.holdingHistory.length-1].units ) - (row.assetGeneral.assetQuote.price *
			row.holdingHistory[row.holdingHistory.length-1].units) ) | currency }}
			<!-- <app-price-compare-item
				[currentPrice]="row.summary.marketPrice * row.units"
				[compareToPrice]="row.breakEvenPrice * row.units"
			>
			</app-price-compare-item> -->
		</td>
	</ng-container>

	<!-- volume -->
	<ng-container matColumnDef="volume">
		<th mat-header-cell *matHeaderCellDef class="hidden md:table-cell">Volume +/-</th>
		<td mat-cell *matCellDef="let row" class="hidden md:table-cell">
			{{ (row.assetGeneral.assetQuote.volume - row.assetGeneral.assetQuote.avgVolume) /
			row.assetGeneral.assetQuote.avgVolume | percent }}
			<!-- <app-price-compare-item
				[currentPrice]="row.summary.marketPrice * row.units"
				[compareToPrice]="row.summary.previousClose * row.units"
			>
			</app-price-compare-item> -->
		</td>
	</ng-container>

	<!-- portfolio_prct -->
	<ng-container matColumnDef="portfolio_prct">
		<th mat-header-cell *matHeaderCellDef class="hidden sm:table-cell">Perfolio %</th>
		<td mat-cell *matCellDef="let row" class="hidden sm:table-cell">
			<span> TODO </span>
			<!-- 		{{ totalPortfolio ? ((row.summary.marketPrice * row.units / totalPortfolio | percent: '1.2-2')) : 'N/A' }} -->
		</td>
	</ng-container>

	<!-- market_cap -->
	<ng-container matColumnDef="market_cap">
		<th mat-header-cell *matHeaderCellDef class="hidden sm:table-cell">Market cap.</th>
		<td mat-cell *matCellDef="let row" class="hidden sm:table-cell">
			{{ row.assetGeneral.assetQuote.marketCap | largeNumberFormatter }}
		</td>
	</ng-container>

	<!-- value -->
	<!-- <ng-container matColumnDef="value">
		<th mat-header-cell *matHeaderCellDef class="hidden sm:table-cell">Value</th>
		<td mat-cell *matCellDef="let row">
			<div [@marketValueChange]="row.summary.marketPrice" class="text-right sm:text-left">
				{{ (row.summary.marketPrice * row.units) | currency }}
			</div>
			<div class="text-gray-500 text-sm hidden sm:table-cell">
				{{ row.summary.marketPrice | currency }} * {{ row.units }}
			</div>

			<div class="flex justify-end sm:hidden">
				<app-price-compare-item
					pricePosition="right"
					[currentPrice]="row.summary.marketPrice * row.units"
					[compareToPrice]="showDailyChange ? (row.summary.previousClose * row.units) : (row.breakEvenPrice * row.units)"
				>
				</app-price-compare-item>
			</div>
		</td>
	</ng-container> -->

	<!-- 52 week change -->
	<ng-container matColumnDef="52WeekRange">
		<th mat-header-cell *matHeaderCellDef class="hidden md:table-cell">52 Week range</th>
		<td mat-cell *matCellDef="let row" class="hidden md:table-cell">
			<div style="width: 90%">
				<app-progress-item [max]="row.fiftyTwoWeekHigh" [min]="row.fiftyTwoWeekLow" [value]="row.regularMarketPrice">
				</app-progress-item>
			</div>
		</td>
	</ng-container>

	<!-- TODO additional info ???? PE/EPS -->
	<ng-container matColumnDef="addditional_info">
		<th mat-header-cell *matHeaderCellDef class="hidden sm:table-cell">Additional info</th>
		<td mat-cell *matCellDef="let row" class="hidden sm:table-cell">TODO</td>
	</ng-container>

	<tr mat-header-row *matHeaderRowDef="displayedColumns" class="hidden sm:contents"></tr>
	<tr mat-row *matRowDef="let row; columns: displayedColumns" (click)="onItemClicked(row)"></tr>

	<!-- Row shown when there is no matching data. -->
	<tr class="mat-row" *matNoDataRow>
		<td class="mat-cell text-center" colspan="10">No holdings to be found</td>
	</tr>
</table>
