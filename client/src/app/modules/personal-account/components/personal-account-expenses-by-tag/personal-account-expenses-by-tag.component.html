<div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4">
	<button
		*ngFor="let aggregation of aggregations"
		mat-button
		[matTooltip]="aggregation.budgetToTimePeriod ? ('Spending on: ' + ((aggregation.totalValue / aggregation.budgetToTimePeriod) | percent) ) : ''"
		(click)="onClick(aggregation)"
		[ngClass]="{
      'cursor-default': disabled,
      'c-selected-button': selectedAggregationIds | inArray: aggregation.id,
      'bg-wt-background-dark': !(selectedAggregationIds | inArray: aggregation.id)
    }"
		class="w-full max-sm:p-0 shadow-lg md:py-4 h-[95px] md:h-[110px] overflow-hidden"
	>
		<div class="flex items-center gap-2 -ml-1">
			<!-- tag image -->
			<div
				class="p-2 rounded-l-xl w-14 md:w-16 h-[95px] md:h-[110px] grid min-w-[60px]"
				style="background-color: {{aggregation.color}};"
			>
				<img appDefaultImg [src]="aggregation.imageUrl" alt="tag image" class="m-auto h-9" />
			</div>

			<div class="flex flex-col flex-1">
				<!-- body -->
				<ng-container [ngTemplateOutlet]="buttonBody" [ngTemplateOutletContext]="{aggregation:aggregation}">
				</ng-container>

				<!-- progress bar -->
				<div *ngIf="!aggregation.isWeeklyView" class="-mt-1">
					<app-progress-item
						[currentValue]="aggregation.budgetToTimePeriod ? aggregation.totalValue : 0"
						[totalThresholdValue]="aggregation.budgetToTimePeriod ?? 0"
					></app-progress-item>
				</div>
			</div>
		</div>
	</button>
</div>

<!-- button body -->
<ng-template #buttonBody let-aggregation="aggregation">
	<div
		class="flex justify-between flex-1 px-4 pb-4 pl-1"
		[ngClass]="{'items-start': !!aggregation.lastDataEntryDate, 'items-center': !aggregation.lastDataEntryDate}"
	>
		<!-- tag name & entries -->
		<div class="text-start">
			<div
				class="space-x-1"
				[ngClass]="{'text-base':  !!aggregation.lastDataEntryDate, 'text-lg':  !aggregation.lastDataEntryDate}"
			>
				<span style="color: {{aggregation.color}}" class="text-lg">{{ aggregation.name }}</span>
				<!-- <span class="text-gray-400">({{ aggregation.totalEntries }})</span> -->
			</div>
			<!-- <span *ngIf="aggregation.lastDataEntryDate " class="text-gray-400">
				Last: {{ aggregation.lastDataEntryDate | date: 'MMM. d' }}
			</span> -->
			<span class="text-wt-gray-medium"> Total Entries: {{ aggregation.totalEntries }} </span>
		</div>

		<div class="text-end min-w-[100px]" [ngClass]="{'mt-3': !aggregation.budgetToTimePeriod}">
			<!-- total spending and budget -->
			<div class="flex flex-col">
				<span class="text-xl text-white"> {{ aggregation.totalValue | currency }} </span>
				<span *ngIf="aggregation.budgetToTimePeriod && !aggregation.isWeeklyView" class="text-wt-gray-medium">
					{{ aggregation.budgetToTimePeriod | currency }}
				</span>
			</div>
		</div>
	</div>
</ng-template>
