<ng-container *ngIf="personalAccountDetails$ | async as personalAccountDetails; else showSkeleton">
	<!-- account total state -->
	<div
		*ngIf="accountTotalState$ | async as accountTotalState"
		class="flex flex-col justify-between gap-x-8 gap-y-8 lg:flex-row"
	>
		<app-personal-account-account-state
			class="md:basis-3/4"
			[accountState]="accountTotalState"
		></app-personal-account-account-state>

		<app-personal-account-action-buttons
			(buttonClickEmitter)="onActionButtonClick($event)"
		></app-personal-account-action-buttons>
	</div>

	<!-- tag expense legend -->
	<app-scroll-wrapper>
		<app-value-presentation-button-control
			[formControl]="filterDailyDataGroup.controls.selectedTagIds"
			[items]="yearlyExpenseTags$ | async"
			itemKey="id"
			[selectWholeItem]="false"
		></app-value-presentation-button-control>
	</app-scroll-wrapper>

	<div class="grid gap-4" [ngClass]="{'2xl:grid-cols-2': !expandedChart, '2xl:grid-cols-1': !!expandedChart}">
		<!-- account overview chart -->
		<div *ngIf="!expandedChart || expandedChart === ChartExpand.EXPENSE">
			<app-expander
				class="hidden 2xl:block"
				(onExpendClickEmitter)="onExpandChartClick(ChartExpand.EXPENSE)"
				[isExpanded]=" expandedChart === ChartExpand.EXPENSE"
			></app-expander>
			<app-personal-account-tag-spending-chart
				#dataChart
				[accountOverviewChartData]="accountOverviewChartData$ | async"
				[expenseTagsChartData]="totalExpenseTagsChartData$ | async"
				[categories]="categories$ | async"
				[heightPx]="525"
			></app-personal-account-tag-spending-chart>
		</div>

		<!-- expense chart -->
		<div *ngIf="!expandedChart || expandedChart === ChartExpand.GROWTH">
			<app-expander
				class="hidden 2xl:block"
				(onExpendClickEmitter)="onExpandChartClick(ChartExpand.GROWTH)"
				[isExpanded]=" expandedChart === ChartExpand.GROWTH"
				classes="-mb-8 pr-6"
			></app-expander>
			<app-personal-account-account-growth-chart
				#dataChart
				[accountOverviewChartData]="accountOverviewChartData$ | async"
				[categories]="categories$ | async"
				[heightPx]="525"
			></app-personal-account-account-growth-chart>
		</div>
	</div>

	<!-- date filter control -->
	<div class="md:px-8">
		<app-personal-account-daily-entries-filter
			(addDailyEntryClickEmitter)="onDailyEntryClick(null)"
			[formControl]="filterDailyDataGroup.controls.dateFilter"
			[personalAccountDetails]="personalAccountDetails"
		></app-personal-account-daily-entries-filter>
	</div>

	<ng-container
		*ngIf="{
      accountFilteredState: accountFilteredState$ | async,
      filteredDailyData: filteredDailyData$ | async,
      filteredDailyDataLoaded: filteredDailyDataLoaded$ | async,
      isEntryForSelectedMonth: isEntryForSelectedMonth$ | async,
      personalAccountDailyExpensePieChart: personalAccountDailyExpensePieChart$ | async,
      accountTagAggregationForTimePeriod: accountTagAggregationForTimePeriod$ | async,
    } as obs"
	>
		<ng-container *ngIf="obs.filteredDailyDataLoaded; else filteredDataSkeleton">
			<ng-container *ngIf="obs.isEntryForSelectedMonth; else noDataForTimePeriod ">
				<div class="grid items-center grid-cols-1 gap-4 md:px-8 lg:grid-cols-4">
					<!-- table body -->
					<div class="relative z-10 h-full lg:col-span-2">
						<app-personal-account-daily-entries-table
							(editDailyEntryClickEmitter)="onDailyEntryClick($event)"
							[personalAccountDailyData]="obs.filteredDailyData"
						></app-personal-account-daily-entries-table>
					</div>

					<!-- spending allocation by tags -->
					<div class="lg:col-span-2 lg:-mt-12">
						<app-pie-chart
							class="scale-150"
							[series]="obs.personalAccountDailyExpensePieChart"
							[displayValue]="obs.accountFilteredState?.total"
						></app-pie-chart>
					</div>
				</div>

				<!-- displayed expense by tag -->
				<div class="mt-6">
					<h2 class="space-x-2">
						<span>Date:</span>
						<span class="text-wt-gray-medium"
							>{{ filterDailyDataGroup.controls.dateFilter.value | dateFormatter }}</span
						>
					</h2>
					<app-personal-account-expenses-by-tag
						[aggregations]="obs.accountTagAggregationForTimePeriod ?? []"
						[disabled]="true"
					></app-personal-account-expenses-by-tag>
				</div>
			</ng-container>
		</ng-container>
	</ng-container>
</ng-container>

<!-- page skeleton -->
<ng-template #showSkeleton>
	<app-personal-account-desktop-view-skeleton></app-personal-account-desktop-view-skeleton>
</ng-template>

<!-- no data time period -->
<ng-template #noDataForTimePeriod>
	<div class="mt-16 mb-12 text-base text-center text-wt-gray-medium">You have no data for this time period</div>
</ng-template>

<!-- filter table skeleton -->
<ng-template #filteredDataSkeleton>
	<div class="grid items-center grid-cols-1 gap-4 mb-8 lg:grid-cols-4 md:px-8">
		<!-- table body -->
		<div class="h-full lg:col-span-2">
			<div *ngRange="10" class="g-skeleton h-[50px] w-full mb-2"></div>
		</div>

		<!-- spending allocation by tags -->
		<div class="lg:col-span-2 h-[250px] w-full lg:w-10/12 g-skeleton lg:mx-auto">
			<div></div>
		</div>
	</div>

	<!-- displayed expense by tag -->
	<div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
		<div class="w-full g-skeleton h-[95px] md:h-[110px]" *ngRange="12"></div>
	</div>
</ng-template>
