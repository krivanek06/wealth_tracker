<!-- account info -->
<div class="mb-6">
	<app-personal-account-account-state
		[accountState]="accountDisplayedState$ | async"
	></app-personal-account-account-state>
</div>

<!-- expense chart -->
<ng-container *ngIf="accountDisplayedState$ | async as accountState">
	<div class="my-8">
		<app-personal-account-tag-allocation-chart
			[series]="personalAccountDailyExpensePieChart$ | async"
			[heightPx]="225"
			[accountBalance]="accountState.total"
		></app-personal-account-tag-allocation-chart>
	</div>
</ng-container>

<mat-divider></mat-divider>

<!-- action button to add new entry -->
<div class="w-full h-12 mt-4 mb-1">
	<button (click)="onDailyEntryClick(null)" mat-stroked-button type="button" color="primary" class="w-full">
		<mat-icon>add</mat-icon>
		Add daily entry
	</button>
</div>

<mat-divider></mat-divider>

<!-- table filter -->
<div class="mt-3">
	<ng-container [formGroup]="filterDailyDataGroup">
		<app-form-mat-input-wrapper
			inputCaption="Filter by date"
			controlName="dateFilter"
			inputType="SELECT_SOURCE_WRAPPER"
			[inputSourceWrapper]="filterDateInputSourceWrapper$ | async"
		></app-form-mat-input-wrapper>
	</ng-container>
</div>

<!-- title & show history checkbox -->
<div class="flex items-center justify-between mb-4">
	<div class="text-base">
		<ng-container *ngIf="!showHistoryFormControl.value">Tag aggregation</ng-container>
		<ng-container *ngIf="showHistoryFormControl.value">
			<ng-container *ngIf="filterDailyDataGroup.controls.selectedTagIds.value.length > 0">
				Tag:
				<ng-container
					*ngIf="personalAccountBasic | getTagById: filterDailyDataGroup.controls.selectedTagIds.value[0] | async as selectedTag"
				>
					<span style="color: {{selectedTag.color}}"> {{ selectedTag.name}} </span>
				</ng-container>
			</ng-container>
			<ng-container *ngIf="filterDailyDataGroup.controls.selectedTagIds.value.length === 0">
				Show History
			</ng-container>
		</ng-container>
	</div>

	<mat-checkbox class="mr-3" [formControl]="showHistoryFormControl">Show history</mat-checkbox>
</div>

<!-- tag aggregation -->
<ng-container *ngIf="accountTagAggregationForTimePeriod$ | async as aggregations">
	<app-personal-account-expenses-by-tag
		*ngIf="!showHistoryFormControl.value"
		[formControl]="filterDailyDataGroup.controls.selectedTagIds"
		[aggregations]="aggregations"
		[multiple]="false"
	></app-personal-account-expenses-by-tag>
</ng-container>

<!-- historical data -->
<ng-container *ngIf="filteredDailyData$ | async as filteredDailyData">
	<app-personal-account-daily-entries-table
		*ngIf="showHistoryFormControl.value"
		(addDailyEntryClickEmitter)="onDailyEntryClick(null)"
		(editDailyEntryClickEmitter)="onDailyEntryClick($event)"
		[personalAccountDailyData]="filteredDailyData"
	></app-personal-account-daily-entries-table>
</ng-container>
