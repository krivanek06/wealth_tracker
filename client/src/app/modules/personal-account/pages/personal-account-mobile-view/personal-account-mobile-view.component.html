<ng-container *ngIf="personalAccountDetails$ | async as personalAccountDetails; else showSkeleton">
	<!-- account info -->
	<div class="mb-6">
		<app-personal-account-account-state
			[loading]="(filteredDailyDataLoaded$ | async) === false"
			[accountState]="accountDisplayedState$ | async"
		></app-personal-account-account-state>
	</div>

	<ng-container
		*ngIf="{
    filteredDailyDataLoaded: filteredDailyDataLoaded$ | async,
    personalAccountExpensePieChart: personalAccountExpensePieChart$ | async,
    accountDisplayedState: accountDisplayedState$ | async,
  } as obs"
	>
		<!-- expense chart -->
		<div *ngIf="obs.filteredDailyDataLoaded; else chartSkeleton" class="-mt-8">
			<app-pie-chart
				class="scale-110"
				[series]="obs.personalAccountExpensePieChart"
				[displayValue]="obs.accountDisplayedState?.total"
			></app-pie-chart>
		</div>

		<!-- settings -->
		<div *ngIf="obs.filteredDailyDataLoaded" class="relative z-10 flex justify-start mb-4 -mt-4">
			<app-personal-account-action-buttons
				displayType="menu"
				(buttonClickEmitter)="onActionButtonClick($event)"
			></app-personal-account-action-buttons>
		</div>
	</ng-container>

	<div class="my-4">
		<mat-divider></mat-divider>
	</div>

	<!-- date filter control -->
	<app-personal-account-daily-entries-filter
		(addDailyEntryClickEmitter)="onDailyEntryClick(null)"
		[formControl]="filterDailyDataGroup.controls.dateFilter"
		[personalAccountDetails]="personalAccountDetails"
	></app-personal-account-daily-entries-filter>

	<!-- table -->
	<ng-container
		*ngIf="{
      filteredDailyDataLoaded: filteredDailyDataLoaded$ | async,
      accountTagAggregationForTimePeriod: accountTagAggregationForTimePeriod$ | async,
      dailyDataAggregation: dailyDataAggregation$ | async,
    } as obs"
	>
		<ng-container *ngIf="obs.filteredDailyDataLoaded; else filteredDataSkeleton">
			<!-- title & show history checkbox -->
			<div class="mt-2 mb-6">
				<app-personal-account-display-toggle
					*ngIf="!isDateSourceNoDate"
					[formControl]="showHistoryFormControl"
					[selectedTag]="(filterDailyDataGroup.controls.selectedTagIds.value[0] | getTagById)  | async"
				></app-personal-account-display-toggle>
			</div>

			<!-- tag aggregation -->
			<app-personal-account-expenses-by-tag
				*ngIf="!showHistoryFormControl.value"
				[formControl]="filterDailyDataGroup.controls.selectedTagIds"
				[expenses]="obs.accountTagAggregationForTimePeriod?.expenses ?? []"
				[incomes]="obs.accountTagAggregationForTimePeriod?.incomes"
				[multiple]="false"
				[disabledClick]="isDateSourceNoDate"
				[hideBudgeting]="isDateSourceNoDate"
			></app-personal-account-expenses-by-tag>

			<!-- historical data -->
			<app-personal-account-daily-entries-table-mobile
				*ngIf="showHistoryFormControl.value"
				[personalAccountDailyData]="obs.dailyDataAggregation"
				(editDailyEntryClickEmitter)="onDailyEntryClick($event)"
			></app-personal-account-daily-entries-table-mobile>
		</ng-container>
	</ng-container>
</ng-container>

<!-- page skeleton -->
<ng-template #showSkeleton>
	<app-personal-account-mobile-view-skeleton></app-personal-account-mobile-view-skeleton>
</ng-template>

<!-- tag aggregation skeleton -->
<ng-template #filteredDataSkeleton>
	<!-- aggregation text and button -->
	<div class="flex justify-end mb-6">
		<div class="w-[200px] h-11 g-skeleton"></div>
	</div>

	<div class="grid gap-4">
		<div *ngRange="8" class="h-[95px] w-full g-skeleton"></div>
	</div>
</ng-template>

<!-- skeleton for chart -->
<ng-template #chartSkeleton>
	<!-- expense chart -->
	<div class="g-skeleton h-[300px] w-full mb-4"></div>

	<!-- settings button -->
	<div class="g-skeleton h-11 w-[120px] mb-4"></div>
</ng-template>
