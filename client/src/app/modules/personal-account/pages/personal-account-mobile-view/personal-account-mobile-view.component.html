<ng-container *ngIf="personalAccountDetails$ | async as personalAccountDetails; else showSkeleton">
	<!-- account info -->
	<div *ngIf="accountDisplayedState$ | async as accountDisplayedState" class="mb-6">
		<app-personal-account-account-state [accountState]="accountDisplayedState"></app-personal-account-account-state>
	</div>

	<!-- expense chart -->
	<div class="-mt-8">
		<app-pie-chart
			*ngIf="isEntryForSelectedMonth$ | async else noDataForTimePeriod"
			class="scale-110"
			[series]="personalAccountDailyExpensePieChart$ | async"
			[displayValue]="(accountDisplayedState$ | async)?.total"
		></app-pie-chart>
	</div>

	<!-- settings -->
	<div class="relative z-10 flex justify-start mb-4 -mt-4">
		<app-personal-account-action-buttons
			displayType="menu"
			(buttonClickEmitter)="onActionButtonClick($event)"
		></app-personal-account-action-buttons>
	</div>

	<div class="my-4">
		<mat-divider></mat-divider>
	</div>

	<!-- date filter control -->
	<app-personal-account-daily-entries-filter
		(addDailyEntryClickEmitter)="onDailyEntryClick(null)"
		[formControl]="filterDailyDataGroup.controls.dateFilter"
		[personalAccountDetails]="personalAccountDetails"
	></app-personal-account-daily-entries-filter>

	<!-- table -->
	<ng-container
		*ngIf="{
      isEntryForSelectedMonth: isEntryForSelectedMonth$ | async,
      filteredDailyDataLoaded: filteredDailyDataLoaded$ | async,
      accountTagAggregationForTimePeriod: accountTagAggregationForTimePeriod$ | async,
      dailyDataAggregation: dailyDataAggregation$ | async,
    } as obs"
	>
		<ng-container *ngIf="obs.filteredDailyDataLoaded; else filteredDataSkeleton">
			<ng-container *ngIf="obs.isEntryForSelectedMonth; else noDataForTimePeriod ">
				<!-- title & show history checkbox -->
				<div class="mt-2 mb-6">
					<app-personal-account-display-toggle
						[formControl]="showHistoryFormControl"
						[selectedTag]="(filterDailyDataGroup.controls.selectedTagIds.value[0] | getTagById)  | async"
					></app-personal-account-display-toggle>
				</div>

				<!-- tag aggregation -->
				<app-personal-account-expenses-by-tag
					*ngIf="!showHistoryFormControl.value"
					[formControl]="filterDailyDataGroup.controls.selectedTagIds"
					[aggregations]="obs.accountTagAggregationForTimePeriod ?? []"
					[multiple]="false"
				></app-personal-account-expenses-by-tag>

				<!-- historical data -->
				<app-personal-account-daily-entries-table-mobile
					*ngIf="showHistoryFormControl.value"
					[personalAccountDailyData]="obs.dailyDataAggregation"
					(editDailyEntryClickEmitter)="onDailyEntryClick($event)"
				></app-personal-account-daily-entries-table-mobile>
			</ng-container>
		</ng-container>
	</ng-container>
</ng-container>

<!-- page skeleton -->
<ng-template #showSkeleton>
	<app-personal-account-mobile-view-skeleton></app-personal-account-mobile-view-skeleton>
</ng-template>

<!-- tag aggregation skeleton -->
<ng-template #filteredDataSkeleton>
	<!-- aggregation text and button -->
	<div class="flex justify-end mb-6">
		<div class="w-[200px] h-11 g-skeleton"></div>
	</div>

	<div class="grid gap-4">
		<div *ngRange="8" class="h-[95px] w-full g-skeleton"></div>
	</div>
</ng-template>

<!-- no data -->
<ng-template #noDataForTimePeriod>
	<div class="mt-16 mb-12 text-base text-center text-wt-gray-medium">You have no data for this time period</div>
</ng-template>
